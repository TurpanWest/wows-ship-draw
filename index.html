<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="style.css">
  <title>Ship Drawer</title>
</head>
<body>
  <div class="language-switcher">
    <button class="lang-btn" onclick="switchLanguage('en')" id="lang-en">English</button>
    <button class="lang-btn" onclick="switchLanguage('zh')" id="lang-zh">ä¸­æ–‡</button>
  </div>

  <h1 id="title">ğŸ¯ Ship Drawer</h1>

  <div class="input-row">
    <input type="text" id="newShipName" placeholder="Ship Name" />
    <select id="newShipType">
      <option value="DD">DD</option>
      <option value="CA">CA</option>
      <option value="BB">BB</option>
      <option value="CV">CV</option>
      <option value="SS">SS</option>
    </select>
    <button class="add-btn" onclick="addShip()" id="add-btn">â• Add Ship</button>
    <button class="reset-btn" onclick="resetToDefault()" id="reset-btn">ğŸ” Reset to Default</button>
  </div>

  <div id="filters">
    <label><input type="checkbox" id="excludeCV"> ğŸš« <span id="exclude-cv-text">Exclude CV</span></label>
    <label style="margin-left: 15px;"><input type="checkbox" id="excludeSS"> ğŸš« <span id="exclude-ss-text">Exclude SS</span></label>
  </div>

  <div id="ship-list"></div>

  <button class="draw-btn" onclick="drawShip()" id="draw-btn">Draw a Ship</button>
  <div id="result"></div>
  
  <script src="ships.js"></script>
  <script>
    // å¤šè¯­è¨€æ–‡æœ¬
    const translations = {
      en: {
        title: "ğŸ¯ Ship Drawer",
        placeholder: "Ship Name",
        addShip: "â• Add Ship",
        resetDefault: "ğŸ” Reset to Default",
        excludeCV: "Exclude CV",
        excludeSS: "Exclude SS",
        drawShip: "Draw a Ship",
        noShipsMessage: "âš ï¸ No eligible ships available for drawing",
        drawResult: "You drew: {name} ({type})"
      },
      zh: {
        title: "ğŸ¯ èˆ°èˆ¹æŠ½é€‰å™¨",
        placeholder: "èˆ°èˆ¹åç§°",
        addShip: "â• æ·»åŠ èˆ°èˆ¹",
        resetDefault: "ğŸ” æ¢å¤é»˜è®¤",
        excludeCV: "æ’é™¤ CV",
        excludeSS: "æ’é™¤ SS",
        drawShip: "æŠ½ä¸€è‰˜èˆ°èˆ¹",
        noShipsMessage: "âš ï¸ æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„èˆ°èˆ¹å¯ä¾›æŠ½é€‰",
        drawResult: "ä½ æŠ½ä¸­äº†ï¼š{name}ï¼ˆ{type}ï¼‰"
      }
    };

    let currentLanguage = localStorage.getItem("language") || "en";
    let ships = [];

    function initializeShips() {
      const savedShips = localStorage.getItem("shipListV2");
      if (savedShips) {
        ships = JSON.parse(savedShips);
      } else {
        ships = SHIPS_DATA[currentLanguage].slice();
      }
    }

    function saveState() {
      localStorage.setItem("shipListV2", JSON.stringify(ships));
    }

    function switchLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem("language", lang);
      document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';
      
      // æ›´æ–°UIæ–‡æœ¬
      updateUIText();
      
      // æ›´æ–°è¯­è¨€æŒ‰é’®çŠ¶æ€
      document.getElementById("lang-en").classList.toggle("active", lang === "en");
      document.getElementById("lang-zh").classList.toggle("active", lang === "zh");
      
      // å¦‚æœå½“å‰æ²¡æœ‰ä¿å­˜çš„èˆ°èˆ¹åˆ—è¡¨ï¼Œä½¿ç”¨æ–°è¯­è¨€çš„é»˜è®¤èˆ°èˆ¹
      const savedShips = localStorage.getItem("shipListV2");
      if (!savedShips) {
        ships = SHIPS_DATA[currentLanguage].slice();
        renderList();
      }
    }

    function updateUIText() {
      const t = translations[currentLanguage];
      document.getElementById("title").textContent = t.title;
      document.getElementById("newShipName").placeholder = t.placeholder;
      document.getElementById("add-btn").textContent = t.addShip;
      document.getElementById("reset-btn").textContent = t.resetDefault;
      document.getElementById("exclude-cv-text").textContent = t.excludeCV;
      document.getElementById("exclude-ss-text").textContent = t.excludeSS;
      document.getElementById("draw-btn").textContent = t.drawShip;
    }

    function renderList() {
      const container = document.getElementById("ship-list");
      container.innerHTML = "";
      ships.forEach((ship, idx) => {
        const div = document.createElement("div");
        div.className = "ship-item";
        div.innerHTML = `
          <div class='ship-left'>
            <input type='checkbox' id='ship-${idx}' checked>
            <span>${ship.name}</span>
            <span class='type-label'>${ship.type}</span>
          </div>
          <button class='delete-btn' onclick='removeShip(${idx})'>âŒ</button>
        `;
        container.appendChild(div);
      });
    }

    function addShip() {
      const name = document.getElementById("newShipName").value.trim();
      const type = document.getElementById("newShipType").value;
      if (name && !ships.some(s => s.name === name)) {
        ships.push({ name: name, type: type });
        saveState();
        renderList();
      }
      document.getElementById("newShipName").value = "";
    }

    function removeShip(index) {
      ships.splice(index, 1);
      saveState();
      renderList();
    }

    function resetToDefault() {
      ships = SHIPS_DATA[currentLanguage].slice();
      saveState();
      renderList();
    }

    function drawShip() {
      const excludeCV = document.getElementById("excludeCV").checked;
      const excludeSS = document.getElementById("excludeSS").checked;

      const selected = ships.filter((ship, idx) => {
        if (excludeCV && ship.type === "CV") return false;
        if (excludeSS && ship.type === "SS") return false;
        return document.getElementById("ship-" + idx)?.checked;
      });

      const resultDiv = document.getElementById("result");
      const t = translations[currentLanguage];
      
      if (selected.length === 0) {
        resultDiv.innerText = t.noShipsMessage;
        return;
      }

      const chosen = selected[Math.floor(Math.random() * selected.length)];
      resultDiv.innerText = t.drawResult.replace("{name}", chosen.name).replace("{type}", chosen.type);
    }

    // åˆå§‹åŒ–
    initializeShips();
    switchLanguage(currentLanguage);
    renderList();
  </script>
</body>
</html>
